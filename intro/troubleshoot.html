<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Troubleshoot &mdash; EDDL  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="FAQ" href="faq.html" />
    <link rel="prev" title="Build and configuration" href="build-options.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #185070" >
            <a href="../index.html">
            <img src="../_static/logo-eddl-small-white.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="build-options.html">Build and configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Troubleshoot</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#compilation">Compilation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#running-an-example">Running an example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#openmp-macos">OpenMP (MacOS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#undefined-symbols-for-architecture-x86-64">Undefined symbols for architecture x86_64</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#macos-undefined-symbols-for-architecture-x86-64">(MacOS) Undefined symbols for architecture x86_64</a></li>
<li class="toctree-l2"><a class="reference internal" href="#memory">Memory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#memory-optimization">Memory optimization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#protobuf">Protobuf</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#missing-includes">Missing includes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#missing-lib">Missing lib</a></li>
<li class="toctree-l3"><a class="reference internal" href="#no-matching-function">No matching function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#old-version-of-protoc">Old version of protoc</a></li>
<li class="toctree-l3"><a class="reference internal" href="#onnx-functions">ONNX functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cuda">CUDA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#unsupported-gnu-version">Unsupported GNU version</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ides">IDEs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#clion">CLion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dealing-with-numpy-files">Dealing with Numpy files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Get started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage/getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/intermediate.html">Intermediate models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/advanced.html">Advanced models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/pretrained.html">Pretrained models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Videotutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../videotutorials/developers.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../videotutorials/usage.html">Showcase</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Layers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../layers/core.html">Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layers/auxiliar.html">Auxiliar Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layers/activations.html">Activations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layers/data_augmentation.html">Data augmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layers/data_transformation.html">Data transformation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layers/convolutional.html">Convolutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layers/noise.html">Noise Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layers/pooling.html">Pooling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layers/normalization.html">Normalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layers/merge.html">Merge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layers/generators.html">Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layers/operators.html">Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layers/reduction.html">Reduce</a></li>
<li class="toctree-l1"><a class="reference internal" href="../layers/rnn.html">Recurrent</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../model/model.html">Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model/onnx.html">Save and load ONNX models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Training</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../training/coarse.html">Coarse training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../training/fine_grained.html">Fine-grained training</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Test &amp; Score</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../test_score/test_score.html">Test &amp; Score</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Bundle</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../bundle/losses.html">Losses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bundle/metrics.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bundle/regularizers.html">Regularizers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bundle/initializers.html">Initializers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bundle/optimizers.html">Optimizers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Computing Services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../bundle/computing_service.html">CPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bundle/computing_service.html#gpu">GPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bundle/computing_service.html#fpga">FPGA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bundle/computing_service.html#compss">COMPSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bundle/computing_service.html#serialization">Serialization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model Zoo</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../models_zoo/classification.html">Classification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Datasets</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../datasets/classification.html">Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datasets/segmentation.html">Segmentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tensor</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tensor/create.html">Creation Routines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tensor/manipulation.html">Manipulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tensor/image.html">Image operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tensor/indexing.html">Indexing &amp; Sorting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tensor/input_output.html">Input/Output Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tensor/linear_algebra.html">Linear algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tensor/logic_functions.html">Logic functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tensor/math.html">Mathematical functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tensor/misc.html">Misc</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #185070" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">EDDL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Troubleshoot</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/intro/troubleshoot.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="troubleshoot">
<h1>Troubleshoot<a class="headerlink" href="#troubleshoot" title="Permalink to this headline"></a></h1>
<div class="section" id="compilation">
<h2>Compilation<a class="headerlink" href="#compilation" title="Permalink to this headline"></a></h2>
<div class="section" id="running-an-example">
<h3>Running an example<a class="headerlink" href="#running-an-example" title="Permalink to this headline"></a></h3>
<p>If you get an error like <code class="docutils literal notranslate"><span class="pre">Segmentation</span> <span class="pre">fault</span> <span class="pre">(core</span> <span class="pre">dumped)</span></code> while running an example, it could be because you
haven’t changed the computing service used in the example. (e.g: It uses de GPU and you don’t have one)</p>
<p>Also, if it is using CPU and the library has been compiled for CPU, it could be because your processor does not
support AVX instructions.</p>
</div>
<div class="section" id="openmp-macos">
<h3>OpenMP (MacOS)<a class="headerlink" href="#openmp-macos" title="Permalink to this headline"></a></h3>
<p>On MacOS, the Clang that comes with XCode doesn’t support OpenMP. Therefore, we recommend you to install
the GCC compile so that you can take advantange of OpenMP.
<em>(Note: By default, GCC is just a symlink to Clang. more_)</em></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install the real GCC</span>
brew<span class="w"> </span>install<span class="w"> </span>gcc

<span class="c1"># Add flags to cmake</span>
cmake<span class="w"> </span>..<span class="w"> </span>-DCMAKE_PREFIX_PATH<span class="o">=</span><span class="nv">$CONDA_PREFIX</span><span class="w"> </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$CONDA_PREFIX</span>
-DCMAKE_C_COMPILER<span class="o">=</span>/usr/local/Cellar/gcc/10.2.0_3/bin/gcc-10
-DCMAKE_CXX_COMPILER<span class="o">=</span>/usr/local/Cellar/gcc/10.2.0_3/bin/g++-10
</pre></div>
</div>
<p>As a last resort, you can always disable OpenMP and use the EDDL by making use of the cmake flag <code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">BUILD_OPENMP=OFF</span></code></p>
</div>
<div class="section" id="undefined-symbols-for-architecture-x86-64">
<h3>Undefined symbols for architecture x86_64<a class="headerlink" href="#undefined-symbols-for-architecture-x86-64" title="Permalink to this headline"></a></h3>
<p>If you cannot compile the EDDL using the distributed mode due to OpenSSL, you might try these things:</p>
<p>First, make you you have OpenSSL installed:</p>
<ul class="simple">
<li><p>Ubuntu/Debian: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">libcrypto++-dev</span> <span class="pre">libssl-dev</span></code></p></li>
<li><p>MacOS: <code class="docutils literal notranslate"><span class="pre">brew</span> <span class="pre">install</span> <span class="pre">openssl</span></code></p></li>
</ul>
<p>If this does not work, check if the following paths are correctly setup:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># NOTE: This is a copy-paste from &quot;brew&quot;, but for linux should be quite similar.</span>

If<span class="w"> </span>you<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span>have<span class="w"> </span>openssl@1.1<span class="w"> </span>first<span class="w"> </span><span class="k">in</span><span class="w"> </span>your<span class="w"> </span>PATH<span class="w"> </span>run:
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export PATH=&quot;/usr/local/opt/openssl@1.1/bin:$PATH&quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.zshrc

For<span class="w"> </span>compilers<span class="w"> </span>to<span class="w"> </span>find<span class="w"> </span>openssl@1.1<span class="w"> </span>you<span class="w"> </span>may<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span>set:
<span class="w">  </span><span class="nb">export</span><span class="w"> </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">&quot;-L/usr/local/opt/openssl@1.1/lib&quot;</span>
<span class="w">  </span><span class="nb">export</span><span class="w"> </span><span class="nv">CPPFLAGS</span><span class="o">=</span><span class="s2">&quot;-I/usr/local/opt/openssl@1.1/include&quot;</span>

For<span class="w"> </span>pkg-config<span class="w"> </span>to<span class="w"> </span>find<span class="w"> </span>openssl@1.1<span class="w"> </span>you<span class="w"> </span>may<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span>set:
<span class="w">  </span><span class="nb">export</span><span class="w"> </span><span class="nv">PKG_CONFIG_PATH</span><span class="o">=</span><span class="s2">&quot;/usr/local/opt/openssl@1.1/lib/pkgconfig&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="macos-undefined-symbols-for-architecture-x86-64">
<h2>(MacOS) Undefined symbols for architecture x86_64<a class="headerlink" href="#macos-undefined-symbols-for-architecture-x86-64" title="Permalink to this headline"></a></h2>
<p>First, try deleting the <code class="docutils literal notranslate"><span class="pre">build/</span></code> folder and run <code class="docutils literal notranslate"><span class="pre">cmake</span></code> again. If this doesn’t work, try forcing a specific
compiler either with the flag <code class="docutils literal notranslate"><span class="pre">-DCMAKE_CXX_COMPILER</span></code> or by exporting these variables to your environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># In MacOS we recommend CLang</span>

<span class="c1"># Set env variables</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">CC</span><span class="o">=</span>/usr/local/opt/llvm/bin/clang
<span class="nb">export</span><span class="w"> </span><span class="nv">CXX</span><span class="o">=</span>/usr/local/opt/llvm/bin/clang++
<span class="nb">export</span><span class="w"> </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">&quot;-L/usr/local/opt/llvm/lib&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">CPPFLAGS</span><span class="o">=</span><span class="s2">&quot;-I/usr/local/opt/llvm/include&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="memory">
<h2>Memory<a class="headerlink" href="#memory" title="Permalink to this headline"></a></h2>
<div class="section" id="memory-optimization">
<h3>Memory optimization<a class="headerlink" href="#memory-optimization" title="Permalink to this headline"></a></h3>
<p>You can change the memory consumption through three different levels of memory optimization:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">full_mem</span></code> (default): No memory bound (highest speed at the expense of the memory requirements)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mid_mem</span></code>: Slight memory optimization (good trade-off memory-speed)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">low_mem</span></code>: Optimized for hardware with restricted memory capabilities.</p></li>
</ul>
<p>Take into account that these levels respond to the typical memory-speed trade-off</p>
</div>
</div>
<div class="section" id="protobuf">
<h2>Protobuf<a class="headerlink" href="#protobuf" title="Permalink to this headline"></a></h2>
<div class="section" id="missing-includes">
<h3>Missing includes<a class="headerlink" href="#missing-includes" title="Permalink to this headline"></a></h3>
<p>If you get an error like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>.../eddl/src/serialization/onnx/onnx.pb.h:10:10:<span class="w"> </span>fatal<span class="w"> </span>error:<span class="w"> </span>google/protobuf/port_def.inc:<span class="w"> </span>No<span class="w"> </span>such<span class="w"> </span>file<span class="w"> </span>or<span class="w"> </span>directory
<span class="c1">#include &lt;google/protobuf/port_def.inc&gt;</span>
</pre></div>
</div>
<p>First, make sure that you have protobuf installed and cmake is detecting the paths correctly:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--<span class="w"> </span>Protobuf<span class="w"> </span>include:<span class="w"> </span>/usr/include
--<span class="w"> </span>Protobuf<span class="w"> </span>libraries:<span class="w"> </span>/usr/lib/x86_64-linux-gnu/libprotobuf.so-lpthread
--<span class="w"> </span>Protobuf<span class="w"> </span>compiler:<span class="w"> </span>/usr/bin/protoc
</pre></div>
</div>
<p>If you are using conda, first check that you have activated the environment: <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">activate</span> <span class="pre">eddl</span></code>.
Then, if the error persists, check if the paths of protobuf outputed by CMake have been mixed up with the paths from
the system (in case protobuf is also installed in the system) like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--<span class="w"> </span>Protobuf<span class="w"> </span>dir:
--<span class="w"> </span>Protobuf<span class="w"> </span>include:<span class="w"> </span>/usr/include
--<span class="w"> </span>Protobuf<span class="w"> </span>libraries:<span class="w"> </span>/usr/lib/x86_64-linux-gnu/libprotobuf.so-lpthread
--<span class="w"> </span>Protobuf<span class="w"> </span>compiler:<span class="w"> </span>/home/salvacarrion/anaconda3/envs/eddl/bin/protoc
</pre></div>
</div>
<p>You can try fixing it by forcing cmake to look into the conda env using the flags: <code class="docutils literal notranslate"><span class="pre">-DCMAKE_PREFIX_PATH=$CONDA_PREFIX</span> <span class="pre">-DCMAKE_INSTALL_PREFIX=$CONDA_PREFIX</span></code> (We recommend to delete the <code class="docutils literal notranslate"><span class="pre">build/</span></code> folder to avoid cache problems)</p>
<p>If the error persists, use the flag <cite>-D BUILD_SUPERBUILD=ON</cite> to download all dependencies and link them automatically to the EDDL.</p>
</div>
<div class="section" id="missing-lib">
<h3>Missing lib<a class="headerlink" href="#missing-lib" title="Permalink to this headline"></a></h3>
<p>If you get an error like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="o">[</span><span class="m">2</span><span class="o">]</span>:<span class="w"> </span>***<span class="w"> </span>No<span class="w"> </span>rule<span class="w"> </span>to<span class="w"> </span>make<span class="w"> </span>target<span class="w"> </span><span class="s1">&#39;cmake/third_party/protobuf/lib/libprotobuf.a&#39;</span>,<span class="w"> </span>needed<span class="w"> </span>by<span class="w"> </span><span class="s1">&#39;lib64/libeddl.so&#39;</span>.<span class="w">  </span>Stop.
</pre></div>
</div>
<p>It is because, when using <code class="docutils literal notranslate"><span class="pre">-DBUILD_SUPERBUILD=ON</span></code>, all critical dependencies are downloaded and compiled locally. These
compiled libraries can be found in <code class="docutils literal notranslate"><span class="pre">eddl/build/cmake/third_party/</span></code>. The problem with the protobuf static library is
that, in some systems, it can be found either on <code class="docutils literal notranslate"><span class="pre">protobuf/lib/</span></code> or <code class="docutils literal notranslate"><span class="pre">protobuf/lib64/</span></code>.</p>
<p>Because the EDDL looks into <code class="docutils literal notranslate"><span class="pre">lib/</span></code> (by default), when the protobuf library appears in <code class="docutils literal notranslate"><span class="pre">lib64/</span></code> we cannot find it.
To fix this, create a symbolic link from <code class="docutils literal notranslate"><span class="pre">lib64/</span></code> to <code class="docutils literal notranslate"><span class="pre">lib/</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Inside: eddl/build/cmake/third_party/protobuf/</span>
ln<span class="w"> </span>-s<span class="w"> </span>lib64<span class="w"> </span>lib
</pre></div>
</div>
</div>
<div class="section" id="no-matching-function">
<h3>No matching function<a class="headerlink" href="#no-matching-function" title="Permalink to this headline"></a></h3>
<p>See question below (<code class="docutils literal notranslate"><span class="pre">Old</span> <span class="pre">version</span> <span class="pre">of</span> <span class="pre">protoc</span></code>).</p>
</div>
<div class="section" id="old-version-of-protoc">
<h3>Old version of protoc<a class="headerlink" href="#old-version-of-protoc" title="Permalink to this headline"></a></h3>
<p>This is because your version of protobuf is not compatible with the ONNX files we provide (<code class="docutils literal notranslate"><span class="pre">onnx.pb.h/cc</span></code> and
<code class="docutils literal notranslate"><span class="pre">onnx.proto</span></code>). We know that the current version of the EDDL (v0.7 at the moment of writing this) works with
protobuf 3.11. To install it, you can either use the conda environment (recommended):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install dependencies</span>
conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>environment.yml
conda<span class="w"> </span>activate<span class="w"> </span>eddl
</pre></div>
</div>
<p>…or install protobuf manually:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Variables</span>
<span class="nv">PROTOBUF_VERSION</span><span class="o">=</span><span class="m">3</span>.11.4

<span class="c1"># Install requirements</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>wget
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>autoconf<span class="w"> </span>automake<span class="w"> </span>libtool<span class="w"> </span>curl<span class="w"> </span>make<span class="w"> </span>g++<span class="w"> </span>unzip

<span class="c1"># Download source</span>
wget<span class="w"> </span>https://github.com/protocolbuffers/protobuf/releases/download/v<span class="nv">$PROTOBUF_VERSION</span>/protobuf-cpp-<span class="nv">$PROTOBUF_VERSION</span>.tar.gz
tar<span class="w"> </span>-xf<span class="w"> </span>protobuf-cpp-<span class="nv">$PROTOBUF_VERSION</span>.tar.gz

<span class="c1"># Build and install</span>
<span class="nb">cd</span><span class="w"> </span>protobuf-<span class="nv">$PROTOBUF_VERSION</span>
./configure
make<span class="w"> </span>-j<span class="k">$(</span>nproc<span class="k">)</span>
make<span class="w"> </span>install<span class="w">  </span><span class="c1"># you may need sudo</span>
ldconfig
</pre></div>
</div>
<p>If everything is correct, cmake should output something like this, and compile without problems.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">Use</span> <span class="n">Protobuf</span><span class="p">:</span> <span class="n">ON</span>
<span class="o">--</span> <span class="n">Protobuf</span> <span class="nb">dir</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Protobuf</span> <span class="n">include</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">include</span>
<span class="o">--</span> <span class="n">Protobuf</span> <span class="n">libraries</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libprotobuf</span><span class="o">.</span><span class="n">so</span><span class="o">-</span><span class="n">lpthread</span>
<span class="o">--</span> <span class="n">Protobuf</span> <span class="n">compiler</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">protoc</span>
</pre></div>
</div>
</div>
<div class="section" id="onnx-functions">
<h3>ONNX functions<a class="headerlink" href="#onnx-functions" title="Permalink to this headline"></a></h3>
<p>If the ONNX functions don’t work, it might be due to a problem with protobuf, so:</p>
<ol class="arabic">
<li><p>Make sure you have <code class="docutils literal notranslate"><span class="pre">protobuf</span></code> and <code class="docutils literal notranslate"><span class="pre">libprotobuf</span></code> installed in standard paths</p></li>
<li><p>If you are building the EDDL from source:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Make use of the cmake flag: <code class="docutils literal notranslate"><span class="pre">BUILD_PROTOBUF=ON</span></code></p></li>
<li><p>Go to <code class="docutils literal notranslate"><span class="pre">src/serialization/onnx/</span></code> and delete these files: <code class="docutils literal notranslate"><span class="pre">onnx.pb.cc</span></code> and <code class="docutils literal notranslate"><span class="pre">onnx.pb.cc</span></code></p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">protoc</span> <span class="pre">--cpp_out=.</span> <span class="pre">onnx.proto</span></code> in the previous directory (<code class="docutils literal notranslate"><span class="pre">src/serialization/onnx/</span></code>) and make sure these files have been generated: <code class="docutils literal notranslate"><span class="pre">onnx.pb.cc</span></code> and <code class="docutils literal notranslate"><span class="pre">onnx.pb.cc</span></code></p></li>
</ol>
</div></blockquote>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Additionally, we recommend making use of the Anaconda environment (see <a class="reference internal" href="installation.html"><span class="doc">Installation</span></a> section for more details).</p>
</div>
</div>
</div>
<div class="section" id="cuda">
<h2>CUDA<a class="headerlink" href="#cuda" title="Permalink to this headline"></a></h2>
<div class="section" id="unsupported-gnu-version">
<h3>Unsupported GNU version<a class="headerlink" href="#unsupported-gnu-version" title="Permalink to this headline"></a></h3>
<p>If you get an error like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/usr/include/crt/host_config.h:138:2:<span class="w"> </span>error:<span class="w"> </span><span class="c1">#error -- unsupported GNU version! gcc versions later than 8 are not supported!</span>
<span class="m">138</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="c1">#error -- unsupported GNU version! gcc versions later than 8 are not supported!</span>
</pre></div>
</div>
<p>It is because NVIDIA does not support all GNU compilers. Each new version of CUDA supports a different range of GNU compilers.
The solution is to simply use a GNU C++ compiler with a version lower or equal to 8.x. You can do this by:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>//<span class="w"> </span>Exporting<span class="w"> </span>these<span class="w"> </span>aliases<span class="w"> </span>to<span class="w"> </span>.bashrc
<span class="nb">export</span><span class="w"> </span><span class="nv">CC</span><span class="o">=</span>gcc-7
<span class="nb">export</span><span class="w"> </span><span class="nv">CXX</span><span class="o">=</span>g++-7

//<span class="w"> </span>Or<span class="w"> </span>creating<span class="w"> </span>a<span class="w"> </span>symbolic<span class="w"> </span>link<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>CUDA<span class="w"> </span>GCC
sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/usr/bin/gcc-7<span class="w"> </span>/usr/local/cuda/bin/gcc
sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/usr/bin/g++-7<span class="w"> </span>/usr/local/cuda/bin/g++

//<span class="w"> </span>..or<span class="w"> </span><span class="nb">set</span><span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>flags<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>cmake<span class="w"> </span><span class="nb">command</span>
cmake<span class="w"> </span>..<span class="w"> </span>-DCMAKE_PREFIX_PATH<span class="o">=</span><span class="nv">$CONDA_PREFIX</span><span class="w"> </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$CONDA_PREFIX</span><span class="w"> </span><span class="se">\</span>
-DBUILD_TARGET<span class="o">=</span>CUDNN<span class="w"> </span><span class="se">\</span>
-DCMAKE_C_COMPILER<span class="o">=</span>/usr/bin/gcc-7<span class="w"> </span><span class="se">\</span>
-DCMAKE_CXX_COMPILER<span class="o">=</span>/usr/bin/g++-7<span class="w"> </span><span class="se">\</span>
-DCMAKE_CUDA_COMPILER<span class="o">=</span>/usr/local/cuda/bin/nvcc<span class="w"> </span><span class="se">\</span>
-DCMAKE_CUDA_HOST_COMPILER<span class="o">=</span>/usr/bin/g++-7<span class="w"> </span><span class="se">\</span>
</pre></div>
</div>
<p>Anyway, it is convenient to check which is the maximum GCC version that your CUDA supports.</p>
<p>If the problem persists, reinstall CUDA from the <a class="reference external" href="https://developer.nvidia.com/cuda-downloads">official site</a></p>
</div>
</div>
<div class="section" id="ides">
<h2>IDEs<a class="headerlink" href="#ides" title="Permalink to this headline"></a></h2>
<div class="section" id="clion">
<h3>CLion<a class="headerlink" href="#clion" title="Permalink to this headline"></a></h3>
<p>I usually have to set additional flags in order to make CLion able to run the EDDL smoothly:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-DBUILD_TARGET<span class="o">=</span>CUDNN
-DCMAKE_C_COMPILER<span class="o">=</span>/usr/bin/gcc-7
-DCMAKE_CXX_COMPILER<span class="o">=</span>/usr/bin/g++-7
-DCMAKE_CUDA_COMPILER<span class="o">=</span>/usr/local/cuda/bin/nvcc
</pre></div>
</div>
<p>If you want to run it using the conda environment, add:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span>/path/to/dir
-DCMAKE_PREFIX_PATH<span class="o">=</span>/path/to/dir

<span class="c1"># Note:</span>
To<span class="w"> </span>get<span class="w"> </span>the<span class="w"> </span>path,<span class="w"> </span>activate<span class="w"> </span>the<span class="w"> </span>environment<span class="w"> </span>and<span class="w"> </span>type:
<span class="nb">echo</span><span class="w"> </span><span class="nv">$CONDA_PREFIX</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dealing-with-numpy-files">
<h2>Dealing with Numpy files<a class="headerlink" href="#dealing-with-numpy-files" title="Permalink to this headline"></a></h2>
<p>To convert EDDL files (.bin) to numpy files (.npy) or viceversa, we need to install the PyEDDL:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install numpy</span>
pip<span class="w"> </span>install<span class="w"> </span>numpy

<span class="c1"># Install PyEDDL</span>
conda<span class="w"> </span>config<span class="w"> </span>--add<span class="w"> </span>channels<span class="w"> </span>dhealth
conda<span class="w"> </span>config<span class="w"> </span>--add<span class="w"> </span>channels<span class="w"> </span>conda-forge
conda<span class="w"> </span>config<span class="w"> </span>--set<span class="w"> </span>channel_priority<span class="w"> </span>strict
conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>dhealth<span class="w"> </span>pyeddl-cpu<span class="w">  </span><span class="c1"># or *-gpu</span>
</pre></div>
</div>
<p><strong>- From Numpy (.npy) to EDDL (.bin) files:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyeddl.tensor</span> <span class="kn">import</span> <span class="n">Tensor</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Convert numpy to bin</span>
<span class="n">t_npy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;myarray.npy&quot;</span><span class="p">)</span>
<span class="n">t_eddl</span> <span class="o">=</span> <span class="n">Tensor</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">t_npy</span><span class="p">)</span>
<span class="n">t_eddl</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;myarray.bin&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>- From EDDL (.bin) files to Numpy (.npy):</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyeddl.tensor</span> <span class="kn">import</span> <span class="n">Tensor</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Convert bin to numpy</span>
<span class="n">t_bin</span> <span class="o">=</span> <span class="n">Tensor</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;myarray.bin&quot;</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;myarray.npy&quot;</span><span class="p">,</span> <span class="n">t_bin</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="build-options.html" class="btn btn-neutral float-left" title="Build and configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="faq.html" class="btn btn-neutral float-right" title="FAQ" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, EDDL.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>